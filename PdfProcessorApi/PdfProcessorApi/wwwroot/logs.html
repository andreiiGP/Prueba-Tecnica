<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Logs de Procesamiento</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">

    <div class="container mt-5">
        <h2 class="mb-4">Historial de Procesamiento de Archivos</h2>

        <button class="btn btn-secondary mb-3" onclick="cargarLogs()">Actualizar</button>


        <table class="table table-bordered table-hover">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Archivo</th>
                    <th>Estado</th>
                    <th>Fecha</th>
                </tr>
            </thead>
            <tbody id="logsTableBody">
                <tr>
                    <td colspan="4" class="text-center">Cargando...</td>
                </tr>
            </tbody>
        </table>
    </div>

    <a href="admin-claves.html">Administar claves </a>
    <br />
    <a href="index.html">Subir PDF</a>

    <script>
        const apiUrl = 'https://localhost:7029/api/logprocesamiento';//obtengo la url del api

        document.addEventListener('DOMContentLoaded', cargarLogs);

        async function cargarLogs() {
            const tbody = document.getElementById('logsTableBody');
            tbody.innerHTML = '<tr><td colspan="4" class="text-center">Cargando...</td></tr>';

            try {
                const res = await fetch(apiUrl);
                const data = await res.json();

                if (!Array.isArray(data)) {
                    tbody.innerHTML = '<tr><td colspan="4" class="text-center text-danger">Error al cargar los logs</td></tr>';
                    return;
                }

                if (data.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="4" class="text-center">No hay registros aún.</td></tr>';
                    return;
                }

                tbody.innerHTML = '';
                data.forEach(log => {
                    tbody.innerHTML += `
                        <tr>
                            <td>${log.id}</td>
                            <td>${log.nombreArchivo}</td>
                            <td>
                                <span class="badge ${log.estado === 'Processed' ? 'bg-success' : 'bg-warning'}">
                                    ${log.estado}
                                </span>
                            </td>
                            <td>${new Date(log.fecha).toLocaleString()}</td>
                        </tr>
                    `;
                });
            } catch (err) {
                tbody.innerHTML = '<tr><td colspan="4" class="text-center text-danger">Error de conexión con el servidor</td></tr>';
                console.error(err);
            }
        }
    </script>

</body>
</html>
